{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="card" style="margin-bottom: 2em;">
    <div class="card-header">
        <h2>Analytics Dashboard</h2>
    </div>
    <div class="card-body">
        <div style="display: flex; flex-wrap: wrap; gap: 2em; justify-content: flex-start;">
            <div style="flex: 1 1 350px; min-width: 350px;">
                <canvas id="genderChart" height="180"></canvas>
            </div>
            <div style="flex: 1 1 350px; min-width: 350px;">
                <canvas id="maritalStatusChart" height="180"></canvas>
            </div>
            <div style="flex: 1 1 350px; min-width: 350px;">
                <canvas id="subscriptionChart" height="180"></canvas>
            </div>
            <div style="flex: 1 1 350px; min-width: 350px;">
                <canvas id="businessCategoryChart" height="180"></canvas>
            </div>
            <div style="flex: 1 1 350px; min-width: 350px;">
                <canvas id="industrySectorChart" height="180"></canvas>
            </div>
            <div style="flex: 1 1 350px; min-width: 350px;">
                <canvas id="educationChart" height="180"></canvas>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/analytics-dashboard/')
            .then(response => response.json())
            .then(data => {
                // Gender Pie Chart
                new Chart(document.getElementById('genderChart').getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: data.employee_registrations_by_gender.map(item => item.gender),
                        datasets: [{
                            label: 'Gender',
                            data: data.employee_registrations_by_gender.map(item => item.count),
                            backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'],
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Employee Registrations by Gender' } }
                    }
                });
                // Marital Status Pie Chart
                new Chart(document.getElementById('maritalStatusChart').getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: data.employee_registrations_by_marital_status.map(item => item.marital_status),
                        datasets: [{
                            label: 'Marital Status',
                            data: data.employee_registrations_by_marital_status.map(item => item.count),
                            backgroundColor: ['#4BC0C0', '#FF9F40', '#9966FF', '#FF6384'],
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Employee Registrations by Marital Status' } }
                    }
                });
                // Employer Subscription Bar Chart
                new Chart(document.getElementById('subscriptionChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: data.employer_registrations_by_subscription.map(item => item.subscription_type),
                        datasets: [{
                            label: 'Subscription Type',
                            data: data.employer_registrations_by_subscription.map(item => item.count),
                            backgroundColor: '#36A2EB',
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Employer Registrations by Subscription Type' } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
                // Employer Business Category Bar Chart
                new Chart(document.getElementById('businessCategoryChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: data.employer_registrations_by_business_category.map(item => item.business_category),
                        datasets: [{
                            label: 'Business Category',
                            data: data.employer_registrations_by_business_category.map(item => item.count),
                            backgroundColor: '#FF6384',
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Employer Registrations by Business Category' } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
                // Employer Industry Sector Bar Chart
                new Chart(document.getElementById('industrySectorChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: data.employer_registrations_by_industry_sector.map(item => item.industry_sector),
                        datasets: [{
                            label: 'Industry Sector',
                            data: data.employer_registrations_by_industry_sector.map(item => item.count),
                            backgroundColor: '#FFCE56',
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Employer Registrations by Industry Sector' } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
                // Job Posts by Education Bar Chart
                new Chart(document.getElementById('educationChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: data.job_posts_by_education.map(item => item.education),
                        datasets: [{
                            label: 'Job Posts by Education',
                            data: data.job_posts_by_education.map(item => item.count),
                            backgroundColor: '#4BC0C0',
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Job Posts by Education' } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            });
    });
</script>
{{ block.super }}
{% endblock %} 